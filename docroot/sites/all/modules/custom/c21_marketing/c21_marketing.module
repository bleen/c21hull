<?php
/**
 * @file
 * Code for the c21 Marketing feature.
 */

include_once 'c21_marketing.features.inc';

/**
 * Implements hook_page_alter().
 */
function c21_marketing_page_alter(&$page) {
  // Remove the page title from basic pages.
  if ($page['#type'] == 'page') {
    unset($page['content']['blockify_blockify-page-title']);
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function c21_marketing_form_contact_site_form_alter(&$form, &$form_state) {
  // Remove the subject & message fields.
  $form['subject']['#access'] = FALSE;
  $form['message']['#access'] = FALSE;
  $form['copy']['#access'] = FALSE;

  // Change the submit button text.
  $form['actions']['submit']['#value'] = t('Contact Us');

  // Add placeholders and remove titles from the email an name fields.
  $form['name']['#title'] = '';
  $form['name']['#placeholder'] = t('Your Name');
  $form['mail']['#title'] = '';
  $form['mail']['#placeholder'] = t('Your Email Address');

  // Add some copy at the top of the form.
  $form['blurb'] = array(
    '#markup' => '<h2>Speak to a Real Estate Professional</h2><p>Get the personalized attention you deserve. Fill out this form to have one of our full-time, certified REALTORS<sup>&reg;</sup> contact you.</p>',
    '#theme_wrappers' => array('container'),
    '#attributes' => array('class' => array('blurb')),
  );

  // Add a phone field.
  $form['phone'] = array(
    '#type' => 'textfield',
    '#placeholder' => '555-555-5555',
  );

  // Add a field to indicate if the user is interested in buying or selling.
  $form['buy_sell'] = array(
    '#title' => t('I\'m interested in'),
    '#type' => 'select',
    '#options' => array(
      'buying' => t('buying'),
      'selling' => t('selling'),
    ),
    '#default_value' => 'buying',
  );

  $form['when'] = array(
    '#title' => t('I\'d like to buy or sell'),
    '#type' => 'select',
    '#options' => array(
      'now' => t('right away'),
      '1-3 month' => t('in 1-3 months'),
      '3-6 months' => t('in 3-6 months'),
      '6+ months' => t('in 6+ months'),
      'eventually' => t('eventually'),
    ),
  );

  $order = array(
    'blurb',
    'name',
    'mail',
    'phone',
    'cid',
    'buy_sell',
    'when',
    'submit'
  );
  foreach ($order as $key => $field) {
    $form[$field]['#weight'] = $key;
  }
}

/**
 * Implements hook_mail_alter().
 */
function c21_marketing_mail_alter(&$message) {
  // We only want to alter the email if it's being
  // generated by the site-wide contact form page.
  if ($message['id'] == 'contact_page_mail') {
    $message['subject'] = t('%name requested he/she be contacted by c21hull.com', array('%name' => $message['params']['name']));
    if (!empty($message['params']['phone'])) {
      $message['body'][] = t('Phone: ') . $message['params']['phone'];
    }
    $message['body'][] = t('Interested in: ') . $message['params']['buy_sell'];
    $message['body'][] = t('He/She would like to buy or sell in: ') . $message['params']['when'];
  }
}
